<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taffi å®¶çš„è²¡å‹™æŒ‡æ®ä¸­å¿ƒ 3.1 (äº’å‹•ç‰ˆ)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px; }
        h1 { text-align: center; color: #2c3e50; font-size: 1.6rem; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #888; font-size: 0.9rem; margin-bottom: 25px; }
        
        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h2 { font-size: 1.2rem; color: #4a90e2; margin-top: 0; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 20px; }
        
        /* --- æ”¶å…¥èˆ‡å…¶ä»–å€å¡Šæ¨£å¼ (ç¶­æŒä¸è®Š) --- */
        .income-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .income-item label { display: block; font-size: 0.85rem; color: #666; margin-bottom: 5px; font-weight: bold; }
        .income-item input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; text-align: center; }
        .total-income { background-color: #e3f2fd; color: #1565c0; padding: 10px; text-align: center; border-radius: 8px; font-weight: bold; font-size: 1.1rem; margin-top: 10px; }
        
        .checklist-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px dashed #eee; }
        .checklist-item:last-child { border-bottom: none; }
        .checklist-item input { margin-right: 15px; width: 20px; height: 20px; cursor: pointer; accent-color: #4a90e2; }
        .checklist-text { flex-grow: 1; font-size: 1rem; }
        .checklist-amt { color: #555; font-weight: bold; }

        .input-group { margin-bottom: 15px; }
        .input-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.95rem; display: flex; justify-content: space-between; }
        .budget-hint { color: #aaa; font-weight: normal; font-size: 0.85rem; }
        
        /* --- æ–°ç‰ˆï¼šéŠ€è¡Œ Tab æ¨£å¼ --- */
        .bank-tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            color: #666;
            background-color: #f0f2f5;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn.active { color: white; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        
        /* å„éŠ€è¡Œä¸»é¡Œè‰² */
        .tab-btn[data-bank="cathay"].active { background-color: #27ae60; }
        .tab-btn[data-bank="taishin"].active { background-color: #e74c3c; }
        .tab-btn[data-bank="fubon"].active { background-color: #2980b9; }

        /* éŠ€è¡Œå…§å®¹é¢æ¿ */
        .bank-panel { display: none; animation: fadeIn 0.3s; }
        .bank-panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .debt-header { margin-bottom: 15px; }
        .debt-header label { display: block; font-size: 0.85rem; color: #888; margin-bottom: 5px; }
        .debt-header input { width: 100%; padding: 12px; font-size: 1.2rem; border: 1px solid #ddd; border-radius: 8px; font-weight: bold; color: #333; }

        /* æ©«å‘æœˆä»½æŒ‰éˆ• */
        .months-row { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); /* ä¸€åˆ—ä¸‰å€‹ */
            gap: 10px; 
            margin-bottom: 20px; 
        }
        .month-btn {
            background: #fafafa;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 15px 5px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        .month-btn:hover { background: #f0f0f0; }
        
        .month-name { display: block; font-size: 0.9rem; color: #888; margin-bottom: 5px; }
        .month-val { display: block; font-size: 1rem; font-weight: bold; color: #333; min-height: 1.2rem;}
        
        /* å·²ä»˜æ¬¾ç‹€æ…‹ */
        .month-btn.paid { background-color: #e8f5e9; border-color: #a5d6a7; }
        .month-btn.paid .month-name { color: #2e7d32; }
        .month-btn.paid .month-val { color: #1b5e20; }

        /* åº•éƒ¨å‰©é¤˜é‡‘é¡é¡¯ç¤º */
        .remain-area {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border-top: 2px dashed #ddd;
        }
        .remain-label { font-size: 0.9rem; color: #666; margin-bottom: 5px; }
        .remain-amount { font-size: 1.8rem; font-weight: 800; color: #2c3e50; }

        /* --- å½ˆå‡ºè¦–çª— (Modal) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); z-index: 100;
            display: none; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 16px; width: 80%; max-width: 320px;
            text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            animation: popIn 0.2s;
        }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .modal-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 15px; }
        .modal-input { width: 100%; padding: 12px; font-size: 1.5rem; text-align: center; border: 2px solid #4a90e2; border-radius: 8px; margin-bottom: 20px; box-sizing: border-box; }
        .modal-btns { display: flex; gap: 10px; }
        .modal-btn { flex: 1; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .btn-cancel { background: #f0f0f0; color: #666; }
        .btn-confirm { background: #2c3e50; color: white; }

        /* çµæœå€ */
        #resultArea { display: none; background-color: #fff; border: 2px solid #4a90e2; }
        .result-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 1.1rem; align-items: center; }
        .highlight { color: #2e7d32; font-weight: bold; font-size: 1.2rem; }
        .taffi-highlight { color: #d81b60; font-weight: bold; font-size: 1.2rem; }
        .divider { border-top: 1px solid #eee; margin: 15px 0; }
        .tag { font-size: 0.75rem; padding: 3px 8px; border-radius: 4px; margin-left: 5px; vertical-align: middle; }
        .tag-taffi { background-color: #fce4ec; color: #c2185b; }
        .tag-em { background-color: #e8f5e9; color: #2e7d32; }
        button.calc-btn { width: 100%; background-color: #2c3e50; color: white; border: none; padding: 16px; border-radius: 10px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; transition: background 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        button.calc-btn:hover { background-color: #1a252f; transform: translateY(-1px); }

    </style>
</head>
<body>

    <h1>ğŸ’° è²¡å‹™æŒ‡æ®ä¸­å¿ƒ 3.1</h1>
    <p class="subtitle">æ”¶å…¥åˆ†é…ãƒ»å‚µå‹™è¿½è¹¤ãƒ»ç›ˆé¤˜çµç®—</p>

    <div class="card">
        <h2>Step 1ï¼šæœˆåˆæ”¶å…¥èˆ‡åˆ†é…</h2>
        <div class="income-grid">
            <div class="income-item">
                <label>åº•è–ª</label>
                <input type="number" id="salaryBase" value="45000" oninput="calcTotalIncome()">
            </div>
            <div class="income-item">
                <label>çé‡‘</label>
                <input type="number" id="salaryBonus" value="0" placeholder="0" oninput="calcTotalIncome()">
            </div>
            <div class="income-item">
                <label>æ”å½±æ£š</label>
                <input type="number" id="salaryStudio" value="0" placeholder="0" oninput="calcTotalIncome()">
            </div>
        </div>
        <div class="total-income" id="totalIncomeDisplay">æœ¬æœˆç¸½æ”¶å…¥ï¼š$45,000</div>
        
        <p style="font-size: 0.9rem; color: #666; margin-top: 20px;">è«‹ç¢ºèªä»¥ä¸‹è³‡é‡‘å·²è½‰å…¥/ä¿ç•™ï¼š</p>
        <div class="checklist-item"><input type="checkbox" id="check1"><div class="checklist-text">ğŸ  æˆ¿è²¸ (çµ¦çˆ¸åª½)</div><div class="checklist-amt">$15,000</div></div>
        <div class="checklist-item"><input type="checkbox" id="check2"><div class="checklist-text">âœˆï¸ æ—…éŠåŸºé‡‘</div><div class="checklist-amt">$6,000</div></div>
        <div class="checklist-item"><input type="checkbox" id="check3"><div class="checklist-text">ğŸš¨ ç·Šæ€¥é å‚™é‡‘</div><div class="checklist-amt">$3,000</div></div>
        <div class="checklist-item"><input type="checkbox" id="check4"><div class="checklist-text">ğŸ¶ Taffi é å‚™é‡‘</div><div class="checklist-amt">$3,000</div></div>
        <div class="checklist-item"><input type="checkbox" id="check5"><div class="checklist-text">ğŸ›¡ï¸ å¹´åº¦æ”¯å‡º</div><div class="checklist-amt">$1,500</div></div>
    </div>

    <div class="card">
        <h2>ğŸ’³ å‚µå‹™é›ªçƒè¿½è¹¤</h2>
        
        <div class="bank-tabs">
            <button class="tab-btn active" data-bank="cathay" onclick="switchBank('cathay')">åœ‹æ³°éŠ€è¡Œ</button>
            <button class="tab-btn" data-bank="taishin" onclick="switchBank('taishin')">å°æ–°éŠ€è¡Œ</button>
            <button class="tab-btn" data-bank="fubon" onclick="switchBank('fubon')">å¯Œé‚¦éŠ€è¡Œ</button>
        </div>

        <div id="cathay-panel" class="bank-panel active">
            <div class="debt-header">
                <label>åˆå§‹ç¸½å‚µå‹™ (æˆªè‡³12æœˆåº•)</label>
                <input type="number" id="cathayTotal" placeholder="è¼¸å…¥ç¸½æ¬ æ¬¾" oninput="updateUI()">
            </div>
            <div class="months-row" id="cathay-months">
                </div>
            <div class="remain-area">
                <div class="remain-label">ç›®å‰å‰©é¤˜æ¬ æ¬¾</div>
                <div class="remain-amount" id="cathayRemain">$0</div>
            </div>
        </div>

        <div id="taishin-panel" class="bank-panel">
            <div class="debt-header">
                <label>åˆå§‹ç¸½å‚µå‹™ (æˆªè‡³12æœˆåº•)</label>
                <input type="number" id="taishinTotal" placeholder="è¼¸å…¥ç¸½æ¬ æ¬¾" oninput="updateUI()">
            </div>
            <div class="months-row" id="taishin-months"></div>
            <div class="remain-area">
                <div class="remain-label">ç›®å‰å‰©é¤˜æ¬ æ¬¾</div>
                <div class="remain-amount" id="taishinRemain">$0</div>
            </div>
        </div>

        <div id="fubon-panel" class="bank-panel">
            <div class="debt-header">
                <label>åˆå§‹ç¸½å‚µå‹™ (æˆªè‡³12æœˆåº•)</label>
                <input type="number" id="fubonTotal" placeholder="è¼¸å…¥ç¸½æ¬ æ¬¾" oninput="updateUI()">
            </div>
            <div class="months-row" id="fubon-months"></div>
            <div class="remain-area">
                <div class="remain-label">ç›®å‰å‰©é¤˜æ¬ æ¬¾</div>
                <div class="remain-amount" id="fubonRemain">$0</div>
            </div>
        </div>

        <div style="display:none;">
            <input type="hidden" id="cathay1"><input type="hidden" id="cathay2">
            <input type="hidden" id="cathay3"><input type="hidden" id="cathay4">
            <input type="hidden" id="cathay5"><input type="hidden" id="cathay6">
            <input type="hidden" id="taishin1"><input type="hidden" id="taishin2">
            <input type="hidden" id="taishin3"><input type="hidden" id="taishin4">
            <input type="hidden" id="taishin5"><input type="hidden" id="taishin6">
            <input type="hidden" id="fubon1"><input type="hidden" id="fubon2">
            <input type="hidden" id="fubon3"><input type="hidden" id="fubon4">
            <input type="hidden" id="fubon5"><input type="hidden" id="fubon6">
        </div>
    </div>

    <div class="card">
        <h2>Step 2ï¼šæœˆåº•çµç®—ç›ˆé¤˜</h2>
        <div class="input-group">
            <label class="input-label">ğŸ¶ ç‹—ç‹—æ”¯å‡º <span class="budget-hint">/ 2,950</span></label>
            <input type="number" id="spentDog" placeholder="è¼¸å…¥èŠ±è²»">
        </div>
        <div class="input-group">
            <label class="input-label">ğŸ± é¤é£²è²»ç”¨ <span class="budget-hint">/ 8,000</span></label>
            <input type="number" id="spentFood" placeholder="è¼¸å…¥èŠ±è²»">
        </div>
        <div class="input-group">
            <label class="input-label">ğŸ›ï¸ è³¼ç‰©è²»ç”¨ <span class="budget-hint">/ 1,700</span></label>
            <input type="number" id="spentShop" placeholder="è¼¸å…¥èŠ±è²»">
        </div>
        <div class="input-group">
            <label class="input-label">ğŸ¬ å…¶ä»–å¨›æ¨‚ <span class="budget-hint">/ 500</span></label>
            <input type="number" id="spentEnt" placeholder="è¼¸å…¥èŠ±è²»">
        </div>
        <button class="calc-btn" onclick="calculate()">ğŸš€ è¨ˆç®—æœ¬æœˆè¦å­˜å¤šå°‘éŒ¢</button>
    </div>

    <div id="resultArea" class="card">
        <h2 style="margin-top:0; border:none; text-align:center; color:#333;">ğŸ‰ çµç®—çµæœ</h2>
        <div class="result-row">
            <span>å­˜å…¥ Taffi é å‚™é‡‘ <span class="tag tag-taffi">ç‹—</span></span>
            <span id="resTaffi" class="taffi-highlight">$0</span>
        </div>
        <div class="result-row">
            <span>å­˜å…¥ ç·Šæ€¥é å‚™é‡‘ <span class="tag tag-em">äºº</span></span>
            <span id="resEmergency" class="highlight">$0</span>
        </div>
        <div class="divider"></div>
        <div class="result-row" style="margin-top: 15px; font-weight: bold;">
            <span>ğŸ’° ç¸½å…±éœ€è½‰å¸³é‡‘é¡ï¼š</span>
            <span id="resTotal" style="color:#2c3e50; font-size: 1.4rem;">$0</span>
        </div>
    </div>

    <div class="modal-overlay" id="paymentModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">è¼¸å…¥é‚„æ¬¾é‡‘é¡</div>
            <input type="number" id="modalInput" class="modal-input" placeholder="$0">
            <div class="modal-btns">
                <button class="modal-btn btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="modal-btn btn-confirm" onclick="confirmPayment()">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <script>
        let currentBank = '';
        let currentMonthIdx = 0;

        window.onload = function() {
            initMonthButtons();
            loadAllData();
        };

        // --- åˆå§‹åŒ–ï¼šç”¢ç”Ÿæœˆä»½æŒ‰éˆ• ---
        function initMonthButtons() {
            const banks = ['cathay', 'taishin', 'fubon'];
            banks.forEach(bank => {
                const container = document.getElementById(bank + '-months');
                container.innerHTML = '';
                for (let i = 1; i <= 6; i++) {
                    // å»ºç«‹æŒ‰éˆ•
                    const btn = document.createElement('div');
                    btn.className = 'month-btn';
                    btn.id = `btn-${bank}${i}`; // æ¯å€‹æŒ‰éˆ•æœ‰ç¨ç«‹ ID
                    btn.onclick = () => openModal(bank, i);
                    
                    // å…§å®¹
                    btn.innerHTML = `
                        <span class="month-name">${i}æœˆ</span>
                        <span class="month-val" id="disp-${bank}${i}">-</span>
                    `;
                    container.appendChild(btn);
                }
            });
        }

        // --- ä»‹é¢æ“ä½œï¼šåˆ‡æ›éŠ€è¡Œ ---
        function switchBank(bankName) {
            // è™•ç† Tab æ¨£å¼
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-btn[data-bank="${bankName}"]`).classList.add('active');

            // è™•ç†é¢æ¿é¡¯ç¤º
            document.querySelectorAll('.bank-panel').forEach(panel => panel.classList.remove('active'));
            document.getElementById(bankName + '-panel').classList.add('active');
        }

        // --- å½ˆå‡ºè¦–çª—æ“ä½œ ---
        function openModal(bank, month) {
            currentBank = bank;
            currentMonthIdx = month;
            
            // è®€å–ç›®å‰éš±è—æ¬„ä½çš„å€¼
            const existingVal = document.getElementById(`${bank}${month}`).value;
            
            document.getElementById('modalTitle').innerText = `${month}æœˆé‚„æ¬¾é‡‘é¡`;
            document.getElementById('modalInput').value = existingVal;
            document.getElementById('paymentModal').style.display = 'flex';
            document.getElementById('modalInput').focus();
        }

        function closeModal() {
            document.getElementById('paymentModal').style.display = 'none';
        }

        function confirmPayment() {
            const val = document.getElementById('modalInput').value;
            // å¯«å…¥éš±è—æ¬„ä½ (é€™æœƒè§¸ç™¼ saveAllData, é€éæ‰‹å‹•å‘¼å«)
            const hiddenInput = document.getElementById(`${currentBank}${currentMonthIdx}`);
            hiddenInput.value = val;
            
            closeModal();
            saveAllData(); // å„²å­˜
            updateUI();    // æ›´æ–°ç•«é¢ (æŒ‰éˆ•è®Šè‰² & é¤˜é¡è¨ˆç®—)
        }

        // --- æ ¸å¿ƒé‚è¼¯ï¼šæ›´æ–°ç•«é¢é¡¯ç¤º ---
        function updateUI() {
            const banks = ['cathay', 'taishin', 'fubon'];
            
            banks.forEach(bank => {
                let totalDebt = Number(document.getElementById(bank + 'Total').value) || 0;
                let paidTotal = 0;

                for(let i=1; i<=6; i++) {
                    const val = document.getElementById(`${bank}${i}`).value;
                    const numVal = Number(val);
                    const btn = document.getElementById(`btn-${bank}${i}`);
                    const disp = document.getElementById(`disp-${bank}${i}`);

                    if(numVal > 0) {
                        btn.classList.add('paid');
                        disp.innerText = "$" + numVal.toLocaleString();
                        paidTotal += numVal;
                    } else {
                        btn.classList.remove('paid');
                        disp.innerText = "-";
                    }
                }

                let remain = totalDebt - paidTotal;
                document.getElementById(bank + 'Remain').innerText = "$" + remain.toLocaleString();
            });
        }

        // --- è‡ªå‹•å„²å­˜ç³»çµ± ---
        function saveAllData() {
            const inputs = document.querySelectorAll('input'); 
            const data = {};
            
            inputs.forEach(input => {
                if (input.id) { 
                    if (input.type === 'checkbox') {
                        data[input.id] = input.checked;
                    } else {
                        data[input.id] = input.value;
                    }
                }
            });
            localStorage.setItem('taffiFinanceFullData_v2', JSON.stringify(data));
        }

        function loadAllData() {
            const saved = localStorage.getItem('taffiFinanceFullData_v2');
            if (saved) {
                const data = JSON.parse(saved);
                const inputs = document.querySelectorAll('input');
                
                inputs.forEach(input => {
                    if (input.id && data.hasOwnProperty(input.id)) {
                        if (input.type === 'checkbox') {
                            input.checked = data[input.id];
                        } else {
                            input.value = data[input.id];
                        }
                    }
                });
            }
            
            // ç¶å®šæ‰€æœ‰è¼¸å…¥æ¡†è®Šæ›´äº‹ä»¶ (è‡ªå‹•å„²å­˜)
            const allInputs = document.querySelectorAll('input');
            allInputs.forEach(input => {
                input.addEventListener('input', () => { saveAllData(); updateUI(); }); // åŠ å…¥ updateUI ç¢ºä¿ç¸½å‚µå‹™è®Šæ›´æ™‚æœƒé‡ç®—
                input.addEventListener('change', () => { saveAllData(); updateUI(); });
            });

            // è¼‰å…¥å®Œç•¢å¾Œï¼Œæ›´æ–°æ”¶å…¥é¡¯ç¤ºå’Œå‚µå‹™ UI
            calcTotalIncome();
            updateUI();
        }

        // --- æ”¶å…¥èˆ‡çµç®—é‚è¼¯ (èˆŠåŠŸèƒ½) ---
        function calcTotalIncome() {
            let base = Number(document.getElementById('salaryBase').value) || 0;
            let bonus = Number(document.getElementById('salaryBonus').value) || 0;
            let studio = Number(document.getElementById('salaryStudio').value) || 0;
            let total = base + bonus + studio;
            document.getElementById('totalIncomeDisplay').innerText = "æœ¬æœˆç¸½æ”¶å…¥ï¼š$" + total.toLocaleString();
        }

        function calculate() {
            const budgetDog = 2950;
            const budgetFood = 8000;
            const budgetShop = 1700;
            const budgetEnt = 500;

            let spentDog = Number(document.getElementById('spentDog').value) || 0;
            let spentFood = Number(document.getElementById('spentFood').value) || 0;
            let spentShop = Number(document.getElementById('spentShop').value) || 0;
            let spentEnt = Number(document.getElementById('spentEnt').value) || 0;

            let leftDog = budgetDog - spentDog;
            let leftFood = budgetFood - spentFood;
            let leftShop = budgetShop - spentShop;
            let leftEnt = budgetEnt - spentEnt;

            let toTaffi = leftDog > 0 ? leftDog : 0;
            let toEmergency = (leftFood + leftShop + leftEnt);
            if (toEmergency < 0) toEmergency = 0; 

            let totalSave = toTaffi + toEmergency;

            document.getElementById('resTaffi').innerText = "$ " + toTaffi.toLocaleString();
            document.getElementById('resEmergency').innerText = "$ " + toEmergency.toLocaleString();
            document.getElementById('resTotal').innerText = "$ " + totalSave.toLocaleString();

            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('resultArea').scrollIntoView({behavior: "smooth"});
        }
    </script>
</body>
</html>
